

<div class="grid" *ngIf=" getToken()=='ADMIN'" >
  <div class="col-12 card px-6 py-6 ">
    <p-toolbar styleClass="mb-4" >
      <ng-template pTemplate="end"  >
        <div class=" my-2 " >

        </div>
      </ng-template>
      <h4>Add analysis report</h4>
    </p-toolbar>
    <div  class=" flex gap-5  mt-8 border-1 border-round border-gray-300 p-6   ">
      <div class=" gap-5  flex flex-column   card  justify-content-between  ">
        <p-floatLabel >
          <input  class="p-2 shadow-1 w-full" type="date" pInputText id="dateCreationph"  [(ngModel)]="analysesChimique.dateAnalyse" [value]="analysesChimique.dateAnalyse" />
          <label for="dateCreationph">date created</label>
          <!--        <p-calendar id="dateCreation" dateFormat="yy-mm-dd" [(ngModel)]="bassin.dateCreation"  [ngClass]="{'ng-invalid ng-dirty' : submitted && !bassin.dateCreation}" [showIcon]="true"></p-calendar>-->
          <!--        <small class="ng-dirty ng-invalid" *ngIf="submitted && !bassin.dateCreation">poste is required.</small>-->
        </p-floatLabel>
        <p-floatLabel>
          <input type="text" pInputText [(ngModel)]="analysesChimique.reference" id="Referenceph" class="w-full"  />
          <label for="Referenceph">Reference</label>
        </p-floatLabel>
        <p-floatLabel>
          <input type="text" pInputText [(ngModel)]="analysesChimique.pluie" id="pluie" class="w-full"  />
          <label for="pluie">Rain</label>
        </p-floatLabel>
        <p-floatLabel>
          <p-autoComplete
            [(ngModel)]="analysesChimique.matiere"
            [dropdown]="true"
            [suggestions]="filtereddataMatire"
            (completeMethod)="filterMatiere($event)"
            field="" />

          <label  >Matter</label>
        </p-floatLabel>
        <p-floatLabel>
           <p-autoComplete
            [(ngModel)]="analysesPhysique.qualite"
            [dropdown]="true"
            [suggestions]="filtereddatasel"
            (completeMethod)="filterCountry($event)"
            field="" />

          <label >Quality</label>

        </p-floatLabel>

      </div>

      <div class="card">
        <p-tabView *ngIf="!isUpdateAnalyseChimique"[scrollable]="true">
          <p-tabPanel header="Pond" >
            <p-listbox [options]="bassins" [(ngModel)]="selectedBassin" optionLabel="nom" (ngModelChange)="selectBassin()"[filter]="true" [listStyle]="{'height': '87px'}"  ></p-listbox>
          </p-tabPanel>
          <p-tabPanel header="Unwashed stock" pTooltip="Enter your username" >
            <p-listbox [options]="sbnls" [(ngModel)]="selectedSbnl" optionLabel="reference" (ngModelChange)="selectSBNL()" [filter]="true" [listStyle]="{'height': '87px'}"  ></p-listbox>

          </p-tabPanel>
          <p-tabPanel header="Band" pTooltip="Enter your username" >
            <p-listbox [options]="bandes" [(ngModel)]="selectedBande" optionLabel="reference" (ngModelChange)="selectBande()"[filter]="true" [listStyle]="{'height': '87px'}"  ></p-listbox>

          </p-tabPanel>
          <p-tabPanel header="Washed stock" >
            <p-listbox [options]="sbls" [(ngModel)]="selectedSbl" optionLabel="reference" [filter]="true" (ngModelChange)="selectSBL()"[listStyle]="{'height': '87px'}" ></p-listbox>

          </p-tabPanel>

          <p-tabPanel header="Final stock" >
            <p-listbox [options]="sblfs" [(ngModel)]="selectedSblf" optionLabel="reference" [filter]="true" (ngModelChange)="selectSBLF()" [listStyle]="{'height': '87px'}" ></p-listbox>

          </p-tabPanel>
        </p-tabView>
      </div>

    </div>
    <div  class=" flex gap-5  mt-8 border-1 border-round border-gray-300 p-6   ">

      <div class="flex align-items-center  gap-1 " >
        <p-checkbox [(ngModel)]="checkedChimique" [binary]="true" Id="ch"></p-checkbox>
        <label for="ny" class="font-bold">Chemical analysis</label>
      </div>

      <div class="flex align-items-center  gap-1 " >
        <p-checkbox  [(ngModel)]="checkedPhysique" [binary]="true" Id="ph"></p-checkbox>
        <label for="ny" class="font-bold">Physical analysis</label>
      </div>



    </div>
    <div  *ngIf="checkedChimique" class="border-1 border-round border-gray-300 p-6 mt-8 bg-gray-200">
      <label class="font-bold text-3xl">Chemical analysis </label>
     <div class="   flex  gap-3  mt-8      ">
      <div   class="card gap-5  flex flex-column       justify-content-between  ">
        <label class="font-bold">climatical</label>
         <p-floatLabel>
          <input type="text" pInputText [(ngModel)]="analysesChimique.temperature"  id="temperature" class="w-full" />
          <label >Temperature °C</label>
        </p-floatLabel>

        <p-floatLabel>
          <input type="text" pInputText [(ngModel)]="analysesChimique.vent"  id="vent" class="w-full" />
          <label >Wind Km/h</label>
        </p-floatLabel>
        <p-floatLabel>
          <textarea rows="3" cols="30" pInputTextarea [(ngModel)]="analysesChimique.description"  id="description" class="w-full" ></textarea>
          <label >Description</label>
        </p-floatLabel>
      </div>

      <div   class=" card  flex w-full  gap-5 flex-column    ">
        <label class="font-bold ">Chemical components </label>

        <div class="flex   gap-5   flex-wrap  overflow-auto  ">
          <p-checkbox [(ngModel)]="SelectAll" (ngModelChange)="SelectAllCheck()" [binary]="true" inputId="binary" class="text-primary" label="All"></p-checkbox>

          <div class="flex align-items-center  gap-1 " *ngFor="let attribut of attributs">
            <p-checkbox [(ngModel)]="attribut.checked" [binary]="true" Id="ny"></p-checkbox>
            <label for="ny" class="font-bold">{{attribut.name}}</label>
          </div>
        </div>

      </div>
    </div>

    <div class="mt-4   ">
      <div class="row flex flex-wrap justify-content-evenly">
        <div *ngFor="let attribut of getattributs()"  class="m-3   ">

          <p-floatLabel>
            <input type="text" pInputText [(ngModel)]="attribut.value"  id="check" class="w-full" [name]="attribut.name"/>

            <!--              <p-inputNumber class="" [(ngModel)]="attribut.value"  inputId="mile" suffix="  {{attribut.unite}}" mode="decimal" locale="en-US" [minFractionDigits]="3" [name]="attribut.name"></p-inputNumber>-->
            <label>{{attribut.label}}</label>
          </p-floatLabel>

        </div>

<!--        <div *ngFor="let attribut of getattributs()"  class="m-3   ">-->
<!--          <p-floatLabel *ngIf="attribut.name !== 'Fe(CN)₆'">-->
<!--            <p-inputNumber class="" [(ngModel)]="attribut.value" inputId="mile" suffix="  {{attribut.unite}}" mode="decimal" locale="en-US" [minFractionDigits]="2" [name]="attribut.name"></p-inputNumber>-->
<!--            <label>{{attribut.label}}</label>-->
<!--          </p-floatLabel>-->

<!--          <p-floatLabel *ngIf="attribut.name === 'Fe(CN)₆'">-->
<!--            <p-inputNumber class="" [(ngModel)]="attribut.value" inputId="mile" suffix="  {{attribut.unite}}" mode="decimal" locale="en-US" [minFractionDigits]="0" [name]="attribut.name"></p-inputNumber>-->
<!--            <label>{{attribut.label}}</label>-->
<!--          </p-floatLabel>-->

<!--        </div>-->
      </div>
    </div>
    </div>
<!--    <div class=" flex col-12 justify-content-end">-->
<!--      <button pButton label="Save" icon="pi pi-check" class=" " (click)="saveAnalyseChimique()"></button>-->
<!--    </div>-->


    <div *ngIf="checkedPhysique" class="border-1 border-round border-gray-300 p-6 mt-8 bg-gray-200  ">
      <label class="font-bold text-3xl">Grain size analysis</label>
      <div class="card flex justify-content-between  align-items-center  mt-8 border-1 border-round border-gray-300 p-6   ">

        <p-floatLabel>
          <textarea rows="3" cols="30" pInputTextarea [(ngModel)]="analysesPhysique.description"   class="w-full" ></textarea>
          <label >Description</label>
        </p-floatLabel>

        <p-floatLabel>
          <input type="text" pInputText [(ngModel)]="analysesPhysique.conformite"  id="conformite" />
          <label >Compliance</label>
        </p-floatLabel>



      </div>

      <div class="card  flex  flex-column gap-2 justify-content-end mt-6 ">
        <div class="flex col-12 justify-content-end">
          <button pButton label="Add Sieve" icon="pi pi-plus" class="p-button-success   w-2  " (click)="ajouterTamis()"></button>

        </div>

        <p-dialog [(visible)]="visibale" [style]="{width: '450px'}" header="Add Sieve" [modal]="true" class="p-fluid">

          <div class="  flex flex-column gap-4 ">

            <p-floatLabel>
              <p-inputNumber [disabled]="isUpdateTamis" id="certificat" class="w-1/2 " [(ngModel)]="tamis.calibre"  mode="decimal" locale="en-US" [minFractionDigits]="3"></p-inputNumber>
              <label>Calibre</label>
            </p-floatLabel>

            <p-floatLabel>
              <p-inputNumber id="qui" [(ngModel)]="tamis.masse"   mode="decimal" locale="en-US" [minFractionDigits]="3"></p-inputNumber>
              <label>Weight</label>
            </p-floatLabel>

            <!--        <p-floatLabel>-->
            <!--          <p-inputNumber id="nomVisa" class="w-full " [(ngModel)]="tamis.refus" mode="decimal" locale="en-US" [minFractionDigits]="3"></p-inputNumber>-->
            <!--          <label>Refus</label>-->
            <!--        </p-floatLabel>-->

            <!--        <p-floatLabel>-->
            <!--          <p-inputNumber id="natureAction" class="" [(ngModel)]="tamis.refusCumulated" mode="decimal" locale="en-US" [minFractionDigits]="3"></p-inputNumber>-->
            <!--          <label>Refus Cumulated</label>-->
            <!--        </p-floatLabel>-->

            <!--        <p-floatLabel>-->
            <!--          <p-inputNumber id="observation" class="w-full " [(ngModel)]="tamis.passCumulated"  mode="decimal" locale="en-US" [minFractionDigits]="3"></p-inputNumber>-->
            <!--          <label>Pass Cumulated</label>-->
            <!--        </p-floatLabel>-->



          </div>
          <ng-template pTemplate="footer">
            <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
            <button pButton pRipple label="Add" icon="pi pi-check" class="p-button-text" (click)="saveTamis()"></button>
          </ng-template>

        </p-dialog>

        <p-table #dt [value]="listeTamis"  styleClass="p-datatable-striped" [scrollable]="true" [scrollHeight]="'400px'" [columns]="cols"   editMode="row"  responsiveLayout="scroll"   [globalFilterFields]="['calibre']"    [showCurrentPageReport]="true" currentPageReportTemplate="Display  {first} to  {last} of  {totalRecords} entries" [(selection)]="selectedIntervention" selectionMode="multiple" [rowHover]="true" >
          <ng-template pTemplate="caption">
            <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
              <h5 class="m-0">Thames Management</h5>
              <span class="block mt-2 md:mt-0 p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input  type="text" pInputText (input)="onGlobalFilter(dt, $event)" placeholder="Search..."  class="w-full sm:w-auto"/>
                        </span>



            </div>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>

              <th >Calibre </th>
              <th >Weight </th>
              <th >Refus </th>
              <th >Refus Cumulated</th>
              <th >pass Cumulated </th>
              <th></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-tamis  let-editing="editing">
            <tr [pEditableRow]="tamis">

              <td ><span class="p-column-title" >Calibre</span>

                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input
                      pInputText
                      type="text"
                      [(ngModel)]="tamis.calibre" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{tamis.calibre}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td>
                <span class="p-column-title">Weight</span>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input
                      pInputText
                      type="text"
                      [(ngModel)]="tamis.masse" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{tamis.masse}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td >
                <span class="p-column-title">Refus</span>
                {{tamis.refus}}


              </td>


              <td >
                <span class="p-column-title">Refus Cumulated</span>
                {{tamis.refusCumulated}}
              </td>
              <td>
                <span class="p-column-title">pass Cumulated</span>
                {{tamis.passCumulated}}
              </td>



              <div *ngIf=" getToken()=='ADMIN'"  class="flex mt-2 ">
                <div class="flex align-items-center justify-content-center gap-2" *ngIf="getToken()=='ADMIN'">
                  <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                          (click)="updateTamis()"
                          class="p-button-rounded   mr-2"></button>
                  <button *ngIf="editing" pButton pRipple type="button"  pSaveEditableRow icon="pi pi-check"
                          (click)="saveTamis()"
                          class="p-button-rounded p-button-text  mr-2"></button>
                </div>
                <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning" (click)="deleteTamis(tamis)"></button>
                <!--            <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success" (click)="editTamis(tamis)"></button>-->
              </div>

            </tr>

          </ng-template>
          <ng-template pTemplate="footer">
            <tr >
              <td class="text-3xl">Total </td>
              <td>{{calculateTotalMass().toFixed(2)}}</td>
              <td>{{calculTotalRefus().toFixed(2)}}</td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </ng-template>
        </p-table>

      </div>
      <div class=" flex col-12 justify-content-end">
        <button pButton label="calculate" icon="pi pi-check" class=" " (click)="calculateTamis()"></button>
      </div>
      </div>

  </div>




<!--========================physique========-->



<!---->
<div class=" flex col-12 justify-content-end">
  <button pButton label="Save" icon="pi pi-check" class=" " (click)="saveRapport()"></button>
</div>
<!--========================physique========-->
</div>
